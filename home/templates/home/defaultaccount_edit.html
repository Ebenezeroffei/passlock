{% extends 'home/base.html' %}


{% block head %}
	<title>Edit {{object.account_name}}</title>
{% endblock %}
{% block content %}
	<div class="container" style="margin-top:80px">
		<div id="verification-container" style="max-width:400px;margin:auto">
			<p class="text-info">You need to be verified as the actual user before you can edit the account.</p>
			<div class="form-group">
				<label for="password">Password:</label>
				<input id="password" type="password" class = 'form-control' />
			</div>
			<button id="verify" type="button" class="btn btn-primary btn-block">Verify</button>
		</div>
		<form style="max-width:450px;margin:auto;opacity:0;" action="." method="post" class = 'mt-5 mb-5'>
			{% csrf_token %}
			<div class="form-group">
				<label for="{{ form.username.id_of_label }}">{{object.account_name}} {{ form.username.label}}</label>
				<input type="text" name="{{ form.username.label|lower }}" id = '{{ form.username.id_for_label }}' value="{{ form.username.value }}" class="form-control">
			</div>
			<div class="form-group">
				<label for="{{ form.password.id_of_label }}">{{object.account_name}} {{ form.password.label}}</label>
				<input type="password" name="{{ form.password.label|lower }}"  id = '{{ form.password.id_for_label }}' value="{{ form.password.value }}" class="form-control"/>
			</div>
			<h5 style="margin:auto;" class="text-primary">Custom Fields</h5>
			<span class="text-muted small">You can add custom fields if you want</span>
			<hr style = 'margin:auto;width:100%;'/>
			<div class="btn-group mb-4 mt-1" style="width:100%">
				<button id = 'add' type="button" class="btn btn-sm btn-dark">Add Field</button>
				<button id = 'remove' type="button" class="btn btn-sm btn-danger">Remove Field</button>
			</div>
			<input type="submit" class="btn btn-primary btn-block" value="Save Changes">
		</form>
	</div>
{% endblock %}
{% block javascript %}
	<script>
		// A function that verifies a user before editing an account
		let verifyUser = () => {
			$("form").slideUp('fast'); // Remove the form
			$('#verify').click(function(){
				let password = $('#password').val();
				console.log("Hmmm")
				$.ajax({
					url: "{% url 'passlock:verify' %}",
					data: {
						'password':password,
					},
					dataType: 'json',
					success: function(data){
						if(data['user_status']){
							$('#password').attr('class','form-control border-success');
							$('#verify').attr('class','btn btn-success btn-block');
							$('#verify').text('Verified');
							$('#verification-container').slideUp('slow',function(){
								// Remove the verification button to display the form
								$(this).remove();
								$('form').slideDown('slow');
								$('form').css('opacity','1');
							})
						}
						else{
							$('#password').attr('class','form-control border-danger');
						}
					},
				})
			})
		}
		verifyUser() //Invoke function

		// A function that add or deletes custom fields to an account
		let createOrDeleteCustomFields =  () => {
			// Create button
			$("#add").click(function(){
				console.log("Add");
			})
			
			// Delete button
			$("#remove").click(function(){
				console.log("Remove");
			})
		}
		createOrDeleteCustomFields() //Invoke function 
	</script>
{% endblock %}